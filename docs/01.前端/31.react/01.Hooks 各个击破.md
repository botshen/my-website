---
title: Hooks å„ä¸ªå‡»ç ´
date: 2021-09-08 09:37:33

categories:
  - å‰ç«¯
  - react
 
  - react

---
# Hooks å„ä¸ªå‡»ç ´

# æ‰€æœ‰Hook



## useState

### ä¸å¯å±€éƒ¨æ›´æ–°


åœ¨å‡½æ•°ç»„ä»¶ä¸­ä¸ä¼šå±€éƒ¨æ›´æ–°ï¼Œä¸‹é¢åªæ›´æ–°äº†nameï¼Œå½“ç‚¹å‡»çš„æ—¶å€™ageå°±ä¼šæ¶ˆå¤±ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦ç”¨...æ“ä½œç¬¦æŠŠä¹‹å‰çš„userå¤åˆ¶è¿‡æ¥å†è¦†ç›–å³å¯ã€‚
classç»„ä»¶ä¼šé»˜è®¤åˆå¹¶ç¬¬ä¸€å±‚ã€‚

### åœ°å€å˜åŒ–æ‰æ¸²æŸ“

åœ¨setStateçš„æ—¶å€™ä¸è¦æ”¹ä¹‹å‰çš„å˜é‡ï¼Œå› ä¸ºåœ°å€æ²¡å˜ï¼Œä¸ä¼šæ›´æ–°UIï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ–°ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚

```JavaScript
import React, { useState } from "react";
import ReactDOM from "react-dom";

function App() {
  const [user, setUser] = useState({ name: "Frank", age: 18 });
  const onClick = () => {
  //æ–°ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡
      setUser({
      ...user,
      name: "Jack"
    });
  };
  return (
    <div className="App">
      <h1>{user.name}</h1>
      <h2>{user.age}</h2>
      <button onClick={onClick}>Click</button>
    </div>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);


```


å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œå¥½å¤„æ˜¯å¯ä»¥å‡å°‘è®¡ç®—é‡ï¼Œåªè°ƒç”¨ä¸€æ¬¡ï¼ŒåŸºæœ¬ä¸ç”¨

```JavaScript
import React, { useState } from "react";
import ReactDOM from "react-dom";

function App() {
  const [user, setUser] = useState(() => ({ name: "Frank", age: 18 }));
  const onClick = () => {
    setUser({
      ...user,
      name: "Jack"
    });
  };
  return (
    <div className="App">
      <h1>{user.name}</h1>
      <h2>{user.age}</h2>
      <button onClick={onClick}>Click</button>
    </div>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);
```


### å¯ä»¥æ¥å—å‡½æ•°


```JavaScript
import React, {useState} from "react";
import ReactDOM from "react-dom";

function App() {
  const [n, setN] = useState(0)
  const onClick = ()=>{
    // setN(n+1)
    // setN(n+1) // ä½ ä¼šå‘ç° n ä¸èƒ½åŠ  2
    setN(i=>i+1)
    setN(i=>i+1)
  }
  return (
    <div className="App">
      <h1>n: {n}</h1>
       
      <button onClick={onClick}>+2</button>
    </div>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);


```


## useReducer

### ä½¿ç”¨æ–¹æ³•

1. åˆ›å»ºåˆå§‹å€¼ initialState

```JavaScript
const initial = {
    n: 0
}
```


2. åˆ›å»ºæ‰€æœ‰æ“ä½œreducer(state,action)

&ensp;&ensp;&ensp;&ensp;å‚æ•°é‡Œæ˜¯æ—§çš„stateå’ŒåŠ¨ä½œï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„state
&ensp;&ensp;&ensp;&ensp;ç¬¬å››è¡Œå¦‚æœåŠ¨ä½œçš„ç±»å‹æ˜¯multiå°±renturnä¸€ä¸ªæ–°çš„næ˜¯æ—§çš„nä¹˜2
&ensp;&ensp;&ensp;&ensp;æ—§çš„nç”¨state.nè¡¨ç¤º
&ensp;&ensp;&ensp;&ensp;è¿™é‡Œå°±æ˜¯æŠŠå¯¹nçš„æ‰€æœ‰æ“ä½œå†™åœ¨å‡½æ•°é‡Œé¢

```JavaScript
const reducer = (state, action) => {
    if (action.type === 'add') {
        return {n: state.n + action.number}
    } else if (action.type === 'multi') {
        return {n: state.n * 2}
    } else {
        throw new Error('ä¸çŸ¥é“çš„ç±»å‹')
    }
}
```


3. ä¼ ç»™useReducer,å¾—åˆ°è¯»å’Œå†™API

&ensp;&ensp;&ensp;&ensp;useReduceræ¥å—ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€ä¸ªæ˜¯æ‰€æœ‰æ“ä½œï¼Œç¬¬äºŒä¸ªæ˜¯åˆå§‹å€¼
&ensp;&ensp;&ensp;&ensp;å¾—åˆ°å¾—åˆ°è¯»å’Œå†™API
&ensp;&ensp;&ensp;&ensp;æ­¤æ—¶çš„nå°±ä¸æ˜¯näº†ï¼Œæ˜¯state.n
&ensp;&ensp;&ensp;&ensp;åœ¨ç‚¹å‡»äº‹ä»¶é‡Œé¢ä½¿ç”¨dispatchå†™ï¼Œä¼ å…¥ç±»å‹ä¸ºaddï¼Œè¡¨ç¤ºè¦è°ƒç”¨reducerçš„addæ“ä½œ
&ensp;&ensp;&ensp;&ensp;ä¹Ÿå¯ä»¥ä¼ ä¸€ä¸ªå‚æ•°numberï¼Œreduceré‡Œé¢å¯ä»¥é€šè¿‡action.numberæ‹¿åˆ°ä¼ çš„1

```JavaScript
function App() {
    const [state, dispatch] = useReducer(reducer, initial)
    //ES6è·å–state.n
    const {n} = state
    const onClick = () => {
        dispatch({type: 'add', number: 1})
    }
    const onClick2 = () => {
        dispatch({type: 'add', number: 2})
    }
    return (
        <div className="App">
            <h1>n: {n}</h1>
            <button onClick={onClick}>+1</button>
            <button onClick={onClick2}>+2</button>
        </div>
    );
}
```


4. è°ƒç”¨å†™({type:'æ“ä½œç±»å‹'})

useReduceræ˜¯useStateçš„å¤æ‚ç‰ˆ

### è¡¨å•ä¾‹å­

```JavaScript
import React, { useReducer } from "react";
import ReactDOM from "react-dom";
//åˆå§‹å€¼
const initFormData = {
  name: "",
  age: 18,
  nationality: "æ±‰æ—"
};
//æ“ä½œæ±‡æ€»
function reducer(state, action) {
  switch (action.type) {
    case "patch":
      //åˆå¹¶åˆ°ç©ºå¯¹è±¡é‡Œé¢
      return { ...state, ...action.formData };
    case "reset":
      return initFormData;
    default:
      throw new Error();
  }
}

function App() {
  const [formData, dispatch] = useReducer(reducer, initFormData);
  // const patch = (key, value)=>{
  //   dispatch({ type: "patch", formData: { [key]: value } })
  // }
  const onSubmit = () => {};
  const onReset = () => {
    dispatch({ type: "reset" });
  };
  return (
    <form onSubmit={onSubmit} onReset={onReset}>
      <div>
        <label>
          å§“å
          <input
            value={formData.name}
            onChange={e =>
              dispatch({ type: "patch", formData: { name: e.target.value } })
            }
          />
        </label>
      </div>
      <div>
        <label>
          å¹´é¾„
          <input
            value={formData.age}
            onChange={e =>
              dispatch({ type: "patch", formData: { age: e.target.value } })
            }
          />
        </label>
      </div>
      <div>
        <label>
          æ°‘æ—
          <input
            value={formData.nationality}
            onChange={e =>
              dispatch({
                type: "patch",
                formData: { nationality: e.target.value }
              })
            }
          />
        </label>
      </div>
      <div>
        <button type="submit">æäº¤</button>
        <button type="reset">é‡ç½®</button>
      </div>
      <hr />
      {JSON.stringify(formData)}
    </form>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);
```


### å¦‚ä½•ä»£æ›¿Redux

#### ä½¿ç”¨æ–¹æ³•

1. å°†æ•°æ®é›†ä¸­åœ¨ä¸€ä¸ªstoreå¯¹è±¡

```JavaScript
const store = {
  user: null,
  books: null,
  movies: null
};
```


2. å°†æ‰€æœ‰æ“ä½œé›†ä¸­åœ¨reducer

```JavaScript
function reducer(state, action) {
  switch (action.type) {
    case "setUser":
      return { ...state, user: action.user };
    case "setBooks":
      return { ...state, books: action.books };
    case "setMovies":
      return { ...state, movies: action.movies };
    default:
      throw new Error();
  }
}
```


3. åˆ›å»ºcontext

```JavaScript
//é»˜è®¤å€¼ä¸€èˆ¬éƒ½æ˜¯null
const Context = React.createContext(null);
```


4. åˆ›å»ºå¯¹æ•°æ®çš„è¯»å†™API

```JavaScript
function App() {
  //åªèƒ½æ”¾åœ¨å‡½æ•°é‡Œé¢
  const [state, dispatch] = useReducer(reducer, store);
  //...
}

```


5. å°†ç¬¬å››æ­¥çš„å†…å®¹æ”¾åœ¨ç¬¬ä¸‰éƒ¨çš„Context

```JavaScript
    const api = {state, dispatch};
    return (
        <Context.Provider value={api}>
        </Context.Provider>
    );
```


6. ç”¨Context.Providerå°†Contextæä¾›ç»™æ‰€æœ‰ç»„ä»¶

```JavaScript
function App() {
    const [state, dispatch] = useReducer(reducer, store);

    const api = {state, dispatch};
    return (
        <Context.Provider value={api}>
            <User/>
            <hr/>
            <Books/>
            <Movies/>
        </Context.Provider>
    );
}
```


7. å„ä¸ªç»„ä»¶ç”¨useContextè·å–è¯»å–API

```JavaScript
function User() {
    const {state, dispatch} = useContext(Context);
    useEffect(() => {
        ajax("/user").then(user => {
            dispatch({type: "setUser", user: user});
        });
    }, []);
    return (
        <div>
            <h1>ä¸ªäººä¿¡æ¯</h1>
            <div>name: {state.user ? state.user.name : ""}</div>
        </div>
    );
}

```


- å®Œæ•´ä»£ç 

```JavaScript
import React, {useReducer, useContext, useEffect} from "react";
import ReactDOM from "react-dom";

const store = {
    user: null,
    books: null,
    movies: null
};

function reducer(state, action) {
    switch (action.type) {
        case "setUser":
            return {...state, user: action.user};
        case "setBooks":
            return {...state, books: action.books};
        case "setMovies":
            return {...state, movies: action.movies};
        default:
            throw new Error();
    }
}

const Context = React.createContext(null);

function App() {
    const [state, dispatch] = useReducer(reducer, store);

    const api = {state, dispatch};
    return (
        <Context.Provider value={api}>
            <User/>
            <hr/>
            <Books/>
            <Movies/>
        </Context.Provider>
    );
}

function User() {
    const {state, dispatch} = useContext(Context);
    useEffect(() => {
        ajax("/user").then(user => {
            dispatch({type: "setUser", user: user});
        });
    }, []);
    return (
        <div>
            <h1>ä¸ªäººä¿¡æ¯</h1>
            <div>name: {state.user ? state.user.name : ""}</div>
        </div>
    );
}

function Books() {
    const {state, dispatch} = useContext(Context);
    useEffect(() => {
        ajax("/books").then(books => {
            dispatch({type: "setBooks", books: books});
        });
    }, []);
    return (
        <div>
            <h1>æˆ‘çš„ä¹¦ç±</h1>
            <ol>
                {state.books ? state.books.map(book => <li key={book.id}>{book.name}</li>) : "åŠ è½½ä¸­"}
            </ol>
        </div>
    );
}

function Movies() {
    const {state, dispatch} = useContext(Context);
    useEffect(() => {
        ajax("/movies").then(movies => {
            dispatch({type: "setMovies", movies: movies});
        });
    }, []);
    return (
        <div>
            <h1>æˆ‘çš„ç”µå½±</h1>
            <ol>
                {state.movies
                    ? state.movies.map(movie => <li key={movie.id}>{movie.name}</li>)
                    : "åŠ è½½ä¸­"}
            </ol>
        </div>
    );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App/>, rootElement);

// å¸®åŠ©å‡½æ•°

// å‡ ajax
// ä¸¤ç§’é’Ÿåï¼Œæ ¹æ® path è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…å®šæˆåŠŸä¸ä¼šå¤±è´¥
function ajax(path) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (path === "/user") {
                resolve({
                    id: 1,
                    name: "Frank"
                });
            } else if (path === "/books") {
                resolve([
                    {
                        id: 1,
                        name: "JavaScript é«˜çº§ç¨‹åºè®¾è®¡"
                    },
                    {
                        id: 2,
                        name: "JavaScript ç²¾ç²¹"
                    }
                ]);
            } else if (path === "/movies") {
                resolve([
                    {
                        id: 1,
                        name: "çˆ±åœ¨é»æ˜ç ´æ™“å‰"
                    },
                    {
                        id: 2,
                        name: "æ‹æ‹ç¬”è®°æœ¬"
                    }
                ]);
            }
        }, 2000);
    });
}

```


#### æ¨¡å—åŒ–

[https://codesandbox.io/embed/blissful-lehmann-hmmd7?fontsize=14&hidenavigation=1&theme=dark](https://codesandbox.io/embed/blissful-lehmann-hmmd7?fontsize=14&hidenavigation=1&theme=dark)

## useContext


### ç¤ºä¾‹



nå’ŒsetNå¯ä»¥å…±äº«ç»™å­ä»£çš„ä»»ä½•ç»„ä»¶ï¼Œä½¿ç”¨provideråœˆå®šèŒƒå›´ã€‚

### ä»£ç 

```JavaScript
import React, { createContext, useState, useContext } from "react";
import ReactDOM from "react-dom";

import "./styles.css";

const C = createContext(null);

function App() {
  console.log("App æ‰§è¡Œäº†");
  const [n, setN] = useState(0);
  return (
  **//value={{ n, setN }}å€¼å¯ä»¥æ˜¯ä»»ä½•å€¼ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªè¯»å†™æ¥å£ï¼Œè¿™é‡Œç”¨äº†ES6ç¼©å†™** 
    <C.Provider value={{ n, setN }}>
      <div className="App">
        <Baba />
      </div>
    </C.Provider>
  );
}

function Baba() {
  const { n, setN } = useContext(C);
  return (
    <div>
      æˆ‘æ˜¯çˆ¸çˆ¸ n: {n} <Child />
    </div>
  );
}

function Child() {
  const { n, setN } = useContext(C);
  const onClick = () => {
    setN(i => i + 1);
  };
  return (
    <div>
      æˆ‘æ˜¯å„¿å­ æˆ‘å¾—åˆ°çš„ n: {n}
      <button onClick={onClick}>+1</button>
    </div>
  );
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App />, rootElement);
```


### æ³¨æ„äº‹é¡¹

React useContextæ›´æ–°çš„æ—¶å€™æ˜¯è‡ªé¡¶å‘ä¸‹é€çº§æ›´æ–°çš„å½¢å¼æ›´æ–°çš„ã€‚ä¸æ˜¯å“åº”å¼çš„ã€‚
Vue3æ˜¯å“åº”å¼çš„ï¼Œè‡ªå·±å˜äº†å°±æ‰¾è°ç”¨äº†æˆ‘ï¼Œå°±å˜åŒ–è°ã€‚è¿™ä¸ªæ€æƒ³çš„ä¸åŒğŸ¤ 


# useEffect


### ç¬¬ä¸€æ¬¡æ¸²æŸ“æ‰§è¡Œ

ç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºæ•°ç»„

```JavaScript
import React, {useEffect, useState} from "react";
import ReactDOM from "react-dom";

function App() {
    const [n, setN] = useState(0)
    const onClick = () => {
        setN(i => i + 1)
    }
    useEffect(() => {
        console.log('ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œè¿™ä¸€å¥è¯');
    }, [])
    return (
        <div>
            n:{n}
            <button onClick={onClick}>+1</button>
        </div>
    )
}

const rootElement = document.getElementById("root");
ReactDOM.render(<App/>, rootElement);


```


### æ¯æ¬¡éƒ½æ‰§è¡Œ

å°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ä¸ºç©º

```JavaScript
 useEffect(() => {
        console.log('ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œè¿™ä¸€å¥è¯');
    })
```


### å½“æŸä¸ªå€¼å˜åŒ–çš„æ—¶å€™æ‰§è¡Œ

ç¬¬ä¸€æ¬¡ä¹Ÿç®—å˜åŒ–äº†

```JavaScript
 useEffect(() => {
        console.log('nå˜åŒ–äº†');
 },[n])
```


### åªæƒ³nç¬¬äºŒæ¬¡å¼€å§‹ç®—å˜åŒ–æ‰§è¡Œ

```JavaScript
useEffect(() => {
if(n!==0){
  console.log('nå˜åŒ–äº†');
  }
},[n])
```


