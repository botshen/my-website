# rails 实现一个最简单的功能
## 数据库建模

建模工具：`bin/rails g model user email:string name:string`
生成了两个文件
```ruby title="user.rb"
class User < ApplicationRecord
end
```
```ruby title="20220914115059_create_users.rb"
class CreateUsers < ActiveRecord::Migration[7.0]

  # 所有的变更在这里写，执行的时候根据这个信息修改数据库，这个表也可以随时增加新的字段
  def change
    create_table :users do |t|
      t.string :email
      t.string :name
      # 创建两个字段 update_at 和 created_at
      t.timestamps
    end
  end
end

```

- 增加长度限制 limit  https://guides.rubyonrails.org/active_record_migrations.html
-
数据库操作工具：`ActiveRecord::Migration`

同步到数据库命令：`bin/rails db:migrate`

反悔命令：`bin/rails  db:rollback step=1`

## 创建路由
config 目录下的 routes.rb
```ruby
Rails.application.routes.draw do
  post "/users", to: "users#create"
  get "/users/:id", to: "users#show"
end

```
## 创建控制器
脚手架
`bin/rails g controller users show create`
输出 JSON 视图
`render json: user`
帮你创建路由和控制器
```bash
  create  app/controllers/users_controller.rb
       route  get 'users/show'
              get 'users/create'
```
```ruby
class UsersController < ApplicationController
  def show
    p "你访问了 show"
  end

  def create
    p "你访问了 create"
  end
end

```
使用 curl 测试接口
`curl -X POST http://127.0.0.1:4000/users`
```bash
~/r/mangosteen-1 # ❯❯❯ bin/rails s -p 4000
=> Booting Puma
=> Rails 7.0.4 application starting in development
=> Run `bin/rails server --help` for more startup options
Puma starting in single mode...
* Puma version: 5.6.5 (ruby 3.0.0-p0) ("Birdie's Version")
*  Min threads: 5
*  Max threads: 5
*  Environment: development
*          PID: 13712
* Listening on http://127.0.0.1:4000
Use Ctrl-C to stop
Started POST "/users" for 127.0.0.1 at 2022-09-15 17:03:21 +0800
  ActiveRecord::SchemaMigration Pluck (0.7ms)  SELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC
Processing by UsersController#create as */*
"你访问了 create"
Completed 204 No Content in 16ms (ActiveRecord: 0.0ms | Allocations: 16203)
```




